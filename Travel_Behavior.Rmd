---
title: "Travel Behavior"
author: "Nate Lant"
date: "11/19/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(haven)
library(nhts2017)
library(plotly)
library(pander)
library(Hmisc)

source("R/functions.R")

knitr::opts_chunk$set(echo = TRUE)
```

```{r setup.trips, include=F}
nhts_trips %>% View()
nhts_persons %>% View()

nhts_trips %>% left_join(nhts_persons, by = c("houseid", "personid")) %>% View()

```


## Mode Choice

```{r mode.choice}
# Distribution of trips by mode
clean_nhts(nhts_trips, nhts_persons, join_by = c("houseid", "personid"), trptrans) %>%
  plotly_bar_nhts(trptrans, Distribution, "Distribution of Trips by Mode")


```


## Primary Activity in Previous Week
<!--- PRMACT --->
```{r activity}
# Distribution of weekly activities
clean_nhts(nhts_trips, nhts_persons, join_by = c("houseid", "personid"), prmact) %>%
  plotly_bar_nhts(prmact, Distribution, "Distribution of Trips by Mode")


```

## Trip Purpose
<!--- trip purpose summary: Whytrip1s --->

<!--- trip origin purpose: whyfrom --->
<!--- trip destination purpose: whyto --->

## Trip Distance
<!--- TRPMILES --->

```{r trip.miles}
# stat summary of trip distance by work status
summary_nhts(nhts_trips, nhts_persons, join_by = c("houseid", "personid"), trpmiles, worker, "Trip Distance")

nhts_clean(nhts_trips, nhts_persons, join_by = c("houseid", "personid")) %>%
  nhts2_stat_summary(trpmiles, worker)
```

## Trip Duration in Minutes
<!--- TRVLCMIN responses 0-1200 --->

```{r min.summary}
nhts_clean(nhts_trips, nhts_persons, join_by = c("houseid", "personid")) %>%
  nhts_stat_summary(trvlcmin)

```

```{r boxplot.minutes}
nhts_clean(nhts_trips, nhts_persons, join_by = c("houseid", "personid")) %>%
  group_by(Ability) %>%
  filter(worker > 0,
         trvlcmin > 0) %>%
  as_factor() %>%
  mutate(trvlcmin = as.double(trvlcmin)) %>%
  ggplot(aes(x = worker, y = trvlcmin, fill = Ability)) +
  geom_boxplot(position = position_dodge(1))

# test the function
nhts_clean(nhts_trips, nhts_persons, join_by = c("houseid", "personid")) %>%
  nhts2_boxplot(trvlcmin, r_sex)

```

## Number of Drivers in Household
<!--- drvrcnt -->

## Number of Household Vehicles
<!--- HHVehcnt (might need to blend hh and pers data) --->

## Trip distance in miles for personally driven vehicle trips
<!--- VMT_MILE responses 0-5441 --->







